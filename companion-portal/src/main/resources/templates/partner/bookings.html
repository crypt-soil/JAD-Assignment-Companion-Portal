<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>Partner Bookings</title>

<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
	rel="stylesheet">

<style>
body {
	background: #f5f3ff;
}

.page-wrap {
	max-width: 1100px;
	margin: 30px auto;
	padding: 0 16px;
}

.cardx {
	background: #ffffff;
	border-radius: 18px;
	border: 1px solid #ede9fe;
	box-shadow: 0 12px 28px rgba(0, 0, 0, .06);
	padding: 18px;
}

.row-card {
	background: #fff;
	border: 1px solid #ede9fe;
	border-radius: 18px;
	padding: 16px 18px;
	display: flex;
	align-items: center;
	justify-content: space-between;
	gap: 16px;
}

.avatar {
	width: 54px;
	height: 54px;
	border-radius: 50%;
	background: #ede9fe;
	color: #4b37b8;
	display: grid;
	place-items: center;
	font-weight: 800;
	font-size: 20px;
	flex: 0 0 auto;
}

.meta {
	display: flex;
	flex-wrap: wrap;
	gap: 14px;
	color: #4b5563;
	font-size: 14px;
}

.badge-id {
	background: #ede9fe;
	color: #4b37b8;
	border-radius: 999px;
	padding: 4px 10px;
	font-weight: 700;
	font-size: 12px;
	display: inline-block;
}

.btn-soft {
	border-radius: 12px;
	padding: 8px 14px;
	font-weight: 700;
}

.btn-view {
	background: #ffffff;
	border: 1px solid #c4b5fd;
	color: #4b37b8;
}

.btn-view:hover {
	background: #f5f3ff;
	border-color: #a78bfa;
}
.title {
	font-weight: 900;
	color: #3b2ea9;
	margin: 0;
}

.subtitle {
	color: #6b7280;
	margin: 0;
}
</style>
</head>

<body>
<div id="navbar"></div>
	<div class="page-wrap">

		<div class="d-flex align-items-center justify-content-between mb-3">
			<div>
				<h3 class="title">Partner Bookings</h3>
				<p class="subtitle">View bookings assigned to your company and
					open customer details.</p>
			</div>
		</div>

		<div class="cardx">
			<div id="empty" class="alert alert-warning mb-0 d-none">No
				bookings found for your partner account yet.</div>

			<div id="list" class="d-flex flex-column gap-3"></div>
		</div>

	</div>

	<script>
  function getVal(b, key) {
    return (b && (b[key] ?? b[key.replaceAll("-", "_")] ?? b[key.replaceAll("_","-")])) ?? null;
  }

  function firstLetter(serviceName) {
    if (!serviceName || String(serviceName).trim() === "") return "B";
    return String(serviceName).trim().charAt(0).toUpperCase();
  }

  function safeText(v) {
    if (v === null || v === undefined || v === "") return "â€”";
    return v;
  }

  async function loadBookings() {
    const res = await fetch("/portal/partner/bookings/data");
    if (!res.ok) {
      location.href = "/portal/partner/login";
      return;
    }

    const data = await res.json();

    if (data && data.error === "unauthorized") {
      location.href = "/portal/partner/login";
      return;
    }

    const bookings = Array.isArray(data) ? data : [];
    const empty = document.getElementById("empty");
    const list = document.getElementById("list");

    if (bookings.length === 0) {
      empty.classList.remove("d-none");
      return;
    }

    bookings.forEach(b => {
    	const bookingId = b.bookingId ?? b.booking_id ?? b["booking_id"];
    	const detailId  = b.detailId  ?? b.detail_id  ?? b["detail_id"];
    	const serviceName = b.serviceName ?? b.service_name ?? b["service_name"];
    	const start = b.startTime ?? b.start_time ?? b["start_time"];
    	const end   = b.endTime   ?? b.end_time   ?? b["end_time"];
    	const subtotal = b.subtotal ?? b["subtotal"];
    	const special  = b.specialRequest ?? b.special_request ?? b["special_request"];


      const card = document.createElement("div");
      card.className = "row-card";
      card.innerHTML = `
        <div class="d-flex align-items-center gap-3">
          <div class="avatar">${firstLetter(serviceName)}</div>

          <div>
            <div class="d-flex align-items-center gap-2 mb-1">
              <div class="fw-bold" style="color:#111827;">
                Booking <span class="badge-id">ID: ${safeText(bookingId)}</span>
              </div>
            </div>

            <div class="meta">
              <div><span class="fw-semibold">Service:</span> <span>${safeText(serviceName)}</span></div>
              <div><span class="fw-semibold">Start:</span> <span>${safeText(start)}</span></div>
              <div><span class="fw-semibold">End:</span> <span>${safeText(end)}</span></div>
              <div><span class="fw-semibold">Subtotal:</span> <span>${safeText(subtotal)}</span></div>
              ${special ? `<div><span class="fw-semibold">Request:</span> <span>${special}</span></div>` : ``}
            </div>
          </div>
        </div>

        <div class="d-flex align-items-center gap-2">
          <a class="btn btn-soft btn-view" href="/portal/partner/bookings/${b.detailId}">View</a>
        </div>
      `;
      list.appendChild(card);
    });
  }

  loadBookings().catch(() => location.href="/portal/partner/login");
</script>
<script src="/portal/partnerNavbar.js"></script>
</body>
</html>
